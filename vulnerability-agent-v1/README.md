# Vulnerability Agent v1

**Naval Electronic Warfare Attack Response System**

Multi-agent system for detecting, classifying, and responding to electronic warfare attacks on naval vessels. Part 2 of a 3-project naval AI series.

---

## Overview

Vulnerability Agent v1 responds to electronic warfare attacks through a five-phase workflow:

1. **Detection**: Network anomaly analysis (packet loss, latency, corrupted frames)
2. **Classification**: Jamming source identification by type (barrage, spot, sweep, deceptive, etc.)
3. **Planning**: Generation of three distinct countermeasure strategies
4. **Evaluation**: Simulation-based plan validation (iterative planner-evaluator loop)
5. **Execution**: Human-selected plan deployment via ship systems

### Key Features

- 5 specialized AI agents with distinct roles
- Human-in-the-loop (HITL) for final plan selection
- Iterative planner-evaluator pattern ensuring plan viability
- Jamming database with 7 attack types and recommended countermeasures
- Sensor simulation suite (ESM, ELINT, Radar, GNSS, Communications)
- Placeholder actuator tools for countermeasure execution
- Web interface (Gradio) and CLI modes


---

## Project Structure

```
vulnerability-agent-v1/
├── pyproject.toml              # UV dependencies
├── README.md
├── config/
│   ├── agents.yaml             # 5 agent definitions
│   ├── tasks.yaml              # 5 task definitions
│   └── jamming_database.json   # Jamming types & countermeasures
├── src/
│   ├── crew.py                 # Crew definition
│   ├── main.py                 # Public API + CLI + HITL
│   ├── tools/
│   │   ├── multimodal_tools.py         # Sensor simulators
│   │   ├── network_anomaly_detector.py
│   │   ├── jamming_classifier.py
│   │   ├── countermeasure_simulator.py
│   │   └── actuator_tools.py           # 7 dummy actuators
│   ├── models/
│   │   └── attack_data.py      # Pydantic models
│   └── utils/
│       └── logger.py           # Python stdlib logging
├── data/sample_attacks/        # 4 example scenarios
└── gradio_vulnerability_v1_app.py
```

---

## Installation

```bash
# Install dependencies with UV
uv pip install -e .

# Set up environment variables (create .env file)
# ANTHROPIC_API_KEY=sk-ant-...
# or OPENAI_API_KEY=sk-...
```

---

## Usage

### CLI Mode

Run test scenario with sample attack:

```bash
uv run python -m src.main
```

The system will:
1. Analyze sample jamming attack
2. Present 3 countermeasure plans
3. Prompt for plan selection (type 1, 2, or 3)
4. Execute selected plan

### Gradio Web Interface

```bash
uv run python gradio_vulnerability_v1_app.py
```

Navigate to `http://localhost:7860`

**Workflow:**
1. Select predefined scenario or enter custom attack JSON
2. Click "Run Assessment"
3. Review 3 proposed plans in tabs
4. Click button to select and execute plan
5. View execution report

<!-- ### Custom Attack (Python API)

```python
from src.main import run_vulnerability_assessment
import json

attack = {
    "attack_type": "jamming",
    "timestamp": "2025-10-21T14:30:00Z",
    "sources": [{
        "source_id": "J-001",
        "location": {"lat": 36.5, "lon": -6.3},
        "frequency_mhz": 9400.0,
        "power_dbm": 75.0,
        "jamming_type": "barrage",
        "affected_systems": ["communications"]
    }],
    "network_anomalies": {
        "packet_loss": 45,
        "latency_increase": 300
    }
}

def plan_selector(plans):
    # Custom selection logic
    return plans[1]['plan_id']  # Select plan 2

result = run_vulnerability_assessment(
    attack_input=json.dumps(attack),
    hitl_callback=plan_selector
)
``` -->

---

## Sample Scenarios

Four predefined attack scenarios in `data/sample_attacks/`:

| Scenario | Description | Threat Level | Key Features |
|----------|-------------|--------------|--------------|
| **01: Single Barrage** | Wide-band noise jamming | High | 1 source, 45% packet loss |
| **02: Spot Critical** | Precision datalink jamming | Critical | Narrow-band, 85% packet loss |
| **03: Multi-Source** | Coordinated attack | Critical | 3 sources, multiple systems |
| **04: Follower** | Cognitive adaptive jammer | Critical | Tracks frequency changes |

---

## Countermeasure Strategies

The system can propose plans using these countermeasures:

**Electronic Warfare:**
- ECM (Electronic Counter Measures)
- Frequency Hopping
- Power Increase (Burn-through)
- EMCON (Emission Control)

**Kinetic:**
- UAV Neutralization
- Evasive Maneuvers

**Communications:**
- Alternative Channels (SATCOM, UHF, laser)
- Directional Antennas

---

## Technical Architecture

### Agents (5)

- **Cybersecurity Agent**: Network anomaly detection
- **Electronic Warfare Agent**: Jamming classification
- **Tactical Planning Agent**: Countermeasure plan generation
- **Evaluator Agent**: Plan validation via simulation
- **Actuator Agent**: Countermeasure execution

### Key Patterns

**Planner-Evaluator Loop:**
```
Tactical Agent → Evaluator Agent
      ↑                 ↓
      └─── (if rejected) ───┘
```

Iterates until 3 viable plans approved (effectiveness >40%, logically sound).

**Human-In-The-Loop:**
```
3 Approved Plans → Human Selection → Execution
```

Maintains human authority for combat decisions.

### Dependencies

- CrewAI: Multi-agent orchestration
- Pydantic v2: Data validation
- Gradio: Web interface
- UV: Dependency management
- Python stdlib logging

---

## Output Files

After assessment, reports generated in `output/`:

- `network_anomaly_detection_task.md`: Network analysis
- `jamming_classification_task.md`: Source classification
- `tactical_planning_task.md`: 3 proposed plans
- `plan_evaluation_task.md`: Simulation results
- `countermeasure_execution_task.md`: Execution report

---

## Related Projects

Naval Agentic AI Series:

1. **susceptibility-agent-v1**: Stealth and detection avoidance
2. **vulnerability-agent-v1**: Attack response (this project)
3. **[Project 3]**: TBD

All projects share common architecture and reusable components.

---

## Attack Data Format

```json
{
  "attack_type": "jamming",
  "timestamp": "2025-10-21T14:30:00Z",
  "sources": [
    {
      "source_id": "J-001",
      "location": {"lat": 36.5, "lon": -6.3},
      "frequency_mhz": 9400.0,
      "power_dbm": 75.0,
      "jamming_type": "barrage",
      "bandwidth_mhz": 200.0,
      "affected_systems": ["communications", "datalink"],
      "bearing_degrees": 45.0,
      "range_km": 28.5
    }
  ],
  "network_anomalies": {
    "packet_loss": 45,
    "latency_increase": 300,
    "corrupted_frames": 120,
    "connection_drops": 3
  }
}
```

---

## Prompt Tuning Recommendations

### agents.yaml

**Current issues to address:**

1. **Tactical Planning Agent**: Too verbose in backstory, could be more directive
2. **Evaluator Agent**: Approval criteria scattered, should be bullet list
3. **All agents**: Some repetition in tool usage sections

**Improvements:**

```yaml
tactical_planning_agent:
  goal: >
    Generate EXACTLY THREE distinct countermeasure plans using different tactical
    approaches. Plans must address the classified threat and be executable.
  
  backstory: >
    You are the Tactical Action Officer. Your role is to develop multiple courses
    of action for the commanding officer.
    
    PLANNING REQUIREMENTS:
    - Each plan uses fundamentally different strategies (not just parameter variations)
    - Plan 1: Aggressive/offensive electronic warfare
    - Plan 2: Balanced mix of electronic and kinetic responses
    - Plan 3: Defensive/evasive approach
    
    COLLABORATION:
    You work iteratively with the Evaluator Agent. Present plans for simulation.
    If rejected, revise based on feedback. Continue until 3 plans approved.
```

### tasks.yaml

**Current issues:**

1. **Descriptions too long**: Can be more concise
2. **Expected output**: Could use structured templates
3. **Context passing**: Not always clear what data flows between tasks

**Improvements:**

```yaml
tactical_planning_task:
  description: >
    Develop 3 distinct countermeasure plans to neutralize detected jamming.
    
    INPUT: Network anomalies + jamming classification from previous tasks
    
    REQUIREMENTS:
    1. Review threat data (sources, types, affected systems)
    2. Generate 3 plans with DIFFERENT approaches:
       - Plan A: Electronic warfare focus (ECM, frequency hop, power increase)
       - Plan B: Kinetic response (UAV, evasive maneuvers)
       - Plan C: Defensive posture (EMCON, alternative channels)
    3. For each plan specify: countermeasures, effectiveness estimate, pros/cons
    4. Submit plans to Evaluator Agent for simulation
    5. Revise rejected plans until all 3 approved
    
    ITERATION: Loop with evaluator until {plans_approved} == 3
```

---

**Vulnerability Agent v1** - Naval Electronic Warfare Attack Response System

1. **Detecting** network-level anomalies indicating hostile jamming
2. **Classifying** jamming sources by type (barrage, spot, sweep, deceptive, etc.)
3. **Planning** three distinct countermeasure strategies
4. **Evaluating** plans through simulation
5. **Executing** the human-selected plan with ship systems

### Key Features

- ✅ **5 Specialized AI Agents**: Cybersecurity, EW, Tactical Planning, Evaluator, Actuator
- ✅ **Human-In-The-Loop (HITL)**: Commanding officer selects from 3 approved plans
- ✅ **Planner-Evaluator Loop**: Iterative plan refinement until viable
- ✅ **Jamming Database**: 7 jamming types with recommended countermeasures
- ✅ **Sensor Simulation**: ESM, ELINT, Radar, GNSS, Comms receivers
- ✅ **Dummy Actuators**: Placeholder tools for ECM, UAV, frequency hopping, etc.
- ✅ **Gradio Web Interface**: Interactive UI for testing scenarios
- ✅ **CLI Mode**: Command-line testing with sample attacks

---

## 🎯 Use Case: Responding to Jamming Attack

**Scenario**: Hostile UAV launches barrage jamming attack on ship communications

### Workflow

```
1. Cybersecurity Agent
   └─> Detects: 45% packet loss, 300ms latency increase
   
2. EW Agent
   └─> Classifies: Barrage jamming at 9400 MHz from bearing 045°
   
3. Tactical Planning Agent ⟷ Evaluator Agent
   └─> Proposes 3 plans → Evaluator simulates → Iterates until approved
   
4. HUMAN IN THE LOOP 👤
   └─> Commanding officer selects Plan 2 (UAV Neutralization)
   
5. Actuator Agent
   └─> Executes: Deploy UAV → Evasive maneuver → EMCON Bravo
   └─> Result: Jamming source neutralized, comms restored
```

---

## 🏗️ Architecture

### Agents (5)

| Agent | Role | Responsibilities |
|-------|------|-----------------|
| **Cybersecurity** | Network Analyst | Detect packet loss, latency, corrupted frames |
| **Electronic Warfare** | EW Specialist | Classify jamming sources, recommend countermeasures |
| **Tactical Planning** | Response Planner | Develop 3 distinct countermeasure plans |
| **Evaluator** | Plan Validator | Simulate plans, approve if >40% effective |
| **Actuator** | Execution Officer | Deploy countermeasures using ship systems |

### Tools (20+)

**Detection & Classification:**
- Network Anomaly Detector
- Jamming Classifier
- EW Signal Processor
- ESM/ELINT/GNSS/Comms Sensor Simulators

**Planning & Evaluation:**
- Countermeasure Simulator

**Execution (Dummy Actuators):**
- ECM Actuator
- Frequency Hop Actuator
- Power Increase Actuator
- UAV Actuator
- Evasive Maneuver Actuator
- EMCON Actuator
- Alternative Channel Actuator

### Countermeasure Strategies

**Electronic Warfare:**
- ECM (Electronic Counter Measures)
- Frequency Hopping
- Power Increase (Burn-through)
- EMCON (Emission Control)

**Kinetic/Physical:**
- UAV Neutralization
- Evasive Maneuvers
- Chaff/Decoys

**Communication:**
- Alternative Channels (SATCOM, laser, etc.)
- Directional Antennas

---

## 🚀 Quick Start

### Installation

```bash
# Clone repository
cd vulnerability-agent-v1

# Install with UV
uv pip install -e .

# Set up environment
cp .env.example .env
# Edit .env and add your ANTHROPIC_API_KEY or OPENAI_API_KEY
```

### Run Sample Attack

**CLI Mode:**
```bash
uv run python -m src.main
```

The system will:
1. Analyze a sample jamming attack
2. Present 3 countermeasure plans
3. Ask you to select a plan (type 1, 2, or 3)
4. Execute the selected plan

**Gradio Web Interface:**
```bash
uv run python gradio_vulnerability_v1_app.py
```

Open browser to `http://localhost:7860`

---

## 📁 Project Structure

```
vulnerability-agent-v1/
├── pyproject.toml              # UV dependencies
├── README.md
├── config/
│   ├── agents.yaml             # 5 agent definitions
│   ├── tasks.yaml              # 5 task definitions
│   └── jamming_database.json   # Jamming types & countermeasures
├── src/
│   ├── crew.py                 # Crew definition (@CrewBase)
│   ├── main.py                 # Public API + CLI + HITL
│   ├── tools/
│   │   ├── multimodal_tools.py         # Sensor simulators (expanded)
│   │   ├── network_anomaly_detector.py
│   │   ├── jamming_classifier.py
│   │   ├── countermeasure_simulator.py
│   │   └── actuator_tools.py           # 7 dummy actuators
│   ├── models/
│   │   └── attack_data.py      # Pydantic models
│   └── utils/
│       └── logger.py           # Python stdlib logging
├── data/sample_attacks/        # 4 example scenarios (JSON)
│   ├── scenario_01_single_barrage.json
│   ├── scenario_02_spot_critical.json
│   ├── scenario_03_multiple_sources.json
│   └── scenario_04_follower_jamming.json
├── output/                     # Generated reports
└── gradio_vulnerability_v1_app.py
```

---

## 🎮 Usage Examples

### Example 1: CLI Test with Default Scenario

```bash
python -m src.main
```

Output:
```
========================================
HUMAN IN THE LOOP - SELECT COUNTERMEASURE PLAN
========================================

PLAN 1: Aggressive Electronic Countermeasures
  Effectiveness: 85%
  PROS: High effectiveness, Fast execution
  CONS: Increases EM signature

PLAN 2: UAV Kinetic Neutralization
  Effectiveness: 90%
  PROS: Eliminates threat permanently
  CONS: Slow execution, Expends UAV

PLAN 3: Defensive Evasion and EMCON
  Effectiveness: 70%
  PROS: Minimal resource expenditure
  CONS: Lower effectiveness

Enter plan number (1, 2, or 3): 2

✓ Executing UAV Neutralization...
✓ Mission complete - Jamming source eliminated
```

### Example 2: Gradio Interface

```bash
python gradio_vulnerability_v1_app.py
```

1. Select scenario from dropdown (or upload custom JSON)
2. Click "Run Assessment"
3. Review 3 proposed plans in tabs
4. Click button to select plan
5. View execution report

### Example 3: Custom Attack Scenario

```python
from src.main import run_vulnerability_assessment
import json

# Create custom attack
attack = {
    "attack_type": "jamming",
    "timestamp": "2025-10-21T14:30:00Z",
    "sources": [{
        "source_id": "J-999",
        "location": {"lat": 36.5, "lon": -6.3},
        "frequency_mhz": 9400.0,
        "power_dbm": 75.0,
        "jamming_type": "barrage",
        "affected_systems": ["communications"]
    }],
    "network_anomalies": {
        "packet_loss": 45,
        "latency_increase": 300
    }
}

# Run assessment with custom HITL callback
def my_plan_selector(plans):
    # Custom logic to select plan
    return plans[1]['plan_id']  # Select plan 2

result = run_vulnerability_assessment(
    attack_input=json.dumps(attack),
    hitl_callback=my_plan_selector
)

print(f"Selected: {result['selected_plan']}")
print(f"Success: {result['success']}")
```

---

## 📊 Sample Scenarios

### Scenario 1: Single Barrage Jamming
- **Threat**: Low-medium
- **Source**: 1 UAV at 28 km
- **Impact**: 45% packet loss
- **Best Response**: Frequency hopping + ECM

### Scenario 2: Spot Jamming on Datalink
- **Threat**: Critical
- **Source**: Precision jammer at 18 km
- **Impact**: 85% packet loss, fire control disrupted
- **Best Response**: UAV neutralization + alternative channels

### Scenario 3: Multi-Source Coordinated Attack
- **Threat**: Critical
- **Sources**: 3 jammers (barrage + deceptive + sweep)
- **Impact**: 70% packet loss, multiple systems affected
- **Best Response**: Combined ECM + UAV + EMCON

### Scenario 4: Intelligent Follower Jamming
- **Threat**: Critical
- **Source**: Cognitive jammer tracking frequency changes
- **Impact**: 92% packet loss, defeats standard countermeasures
- **Best Response**: EMCON + kinetic neutralization

---

## 🔧 Configuration

### Jamming Database (`config/jamming_database.json`)

Defines 7 jamming types with recommended countermeasures:

- **Barrage**: Wide-band noise jamming
- **Spot**: Narrow-band targeting specific frequencies
- **Sweep**: Frequency-sweeping across bands
- **Deceptive**: False signal injection
- **Pulse**: High-power pulsed interference
- **Noise**: Random spectrum degradation
- **Follower**: Adaptive/cognitive jamming

Each type includes:
- Technical characteristics
- Threat level
- Recommended countermeasures ranked by effectiveness

### Environment Variables

Create `.env` file:

```bash
# LLM API Keys (choose one or both)
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...

# Logging
LOG_LEVEL=INFO

# Optional: HuggingFace token for audio tools
HF_TOKEN=hf_...
```

---

## 🧪 Testing

### Run All Scenarios

```bash
# Scenario 1: Single barrage
python -m src.main

# Scenario 2: Spot jamming
# Load scenario_02_spot_critical.json in Gradio

# Scenario 3: Multi-source
# Load scenario_03_multiple_sources.json in Gradio

# Scenario 4: Follower jamming
# Load scenario_04_follower_jamming.json in Gradio
```

### Expected Output Files

After running assessment, check `output/` directory:

- `network_anomaly_detection_task.md`: Network analysis
- `jamming_classification_task.md`: Jamming source classification
- `tactical_planning_task.md`: 3 proposed plans
- `plan_evaluation_task.md`: Simulation results
- `countermeasure_execution_task.md`: Execution report

---

## 🎯 Key Concepts

### Human-In-The-Loop (HITL)

The commanding officer ALWAYS selects the final plan:

```
Tactical Agent → Evaluator Agent
       ↓ (3 approved plans)
    HUMAN 👤
       ↓ (selects 1 plan)
  Actuator Agent
```

**Why HITL?**
- Maintains human authority in combat decisions
- Allows tactical judgment beyond AI capabilities
- Ensures accountability for kinetic actions

### Planner-Evaluator Loop

Tactical Agent and Evaluator Agent iterate until 3 viable plans approved:

```
Loop:
  1. Tactical proposes 3 plans
  2. Evaluator simulates each
  3. If effectiveness <40% or stupid: REJECT
  4. Tactical revises rejected plans
  5. Repeat until 3 plans approved
```

**Evaluation Criteria (lenient):**
- Effectiveness ≥40% (dummy simulation)
- Plan addresses actual threat
- No obviously flawed logic
- Executable with available resources

### Dummy Actuators

All execution tools are **placeholders** that simulate success/failure:

- Real deployment would integrate with actual ship systems
- Simulation uses randomized success probabilities
- Execution reports show realistic timelines and side effects

---

## 🛠️ Technical Details

### Dependencies

- **CrewAI**: Multi-agent orchestration
- **Pydantic v2**: Data validation with ClassVar
- **Gradio**: Web interface
- **UV**: Fast dependency management
- **Python stdlib logging**: No loguru dependency

### Pydantic Models

Structured attack data with validation:

```python
from src.models.attack_data import AttackScenario, JammingSource

attack = AttackScenario(
    scenario_id="ATTACK-001",
    attack_type="jamming",
    sources=[
        JammingSource(
            source_id="J-001",
            location=Location(lat=36.5, lon=-6.3),
            frequency_mhz=9400.0,
            jamming_type=JammingType.BARRAGE
        )
    ]
)
```

### Logging

Python standard library logging with hierarchical loggers:

```python
from src.utils.logger import get_logger

logger = get_logger(__name__)
logger.info("Processing jamming attack")
```

Logs saved to `logs/vulnerability_agent.log`

---

## 📖 Related Projects

This is **Project 2 of 3** in the Naval Agentic AI series:

1. **susceptibility-agent-v1**: Avoiding detection (stealth mode)
2. **vulnerability-agent-v1**: Responding to attacks (this project)
3. **[Project 3]**: Coming soon

All projects share:
- Common architecture (crew.py → main.py → gradio_app.py)
- UV dependency management
- Python stdlib logging
- Reusable tools (multimodal_tools.py)

---

## 🤝 Contributing

This is a demonstration project for naval AI research. Contributions welcome:

1. Fork the repository
2. Create a feature branch
3. Test with sample scenarios
4. Submit pull request

---

## 📄 License

GNU General Public License (GPL) 3.0

---

## 🔍 Troubleshooting

### Issue: "Config file not found"

```
ERROR: agents.yaml not found
```

**Solution**: Ensure you're running from project root:
```bash
cd vulnerability-agent-v1
python -m src.main
```

### Issue: "No API key found"

```
ERROR: ANTHROPIC_API_KEY not set
```

**Solution**: Create `.env` file with API keys:
```bash
echo "ANTHROPIC_API_KEY=sk-ant-..." > .env
```

### Issue: "Jamming database not found"

```
ERROR: Could not load jamming_database.json
```

**Solution**: Verify `config/jamming_database.json` exists and is valid JSON.

### Issue: Plans not approved

```
WARNING: Plan rejected - effectiveness <40%
```

**Solution**: This is expected behavior. The Tactical Agent will revise and retry automatically.

---

## 📞 Support

For questions or issues:

1. Check `logs/vulnerability_agent.log` for detailed error messages
2. Review sample scenarios in `data/sample_attacks/`
3. Test with default scenario first: `python -m src.main`
4. Open an issue on GitHub

---

## 🎓 Educational Use

This project demonstrates:
- Multi-agent AI systems with CrewAI
- Human-in-the-loop decision making
- Iterative planning with evaluator patterns
- Naval electronic warfare concepts
- Agent-tool architecture design
- Pydantic data validation
- Gradio interface development

Ideal for:
- AI/ML engineers learning multi-agent systems
- Defense researchers studying autonomous systems
- Students exploring human-AI collaboration
- Developers building decision support tools

---

## 🚀 Next Steps

After running vulnerability-agent-v1:

1. **Experiment with custom scenarios**: Create JSON files in `data/sample_attacks/`
2. **Modify jamming database**: Add new jamming types or countermeasures
3. **Implement real actuators**: Replace dummy tools with actual system interfaces
4. **Integrate with Project 1**: Combine stealth and attack response
5. **Build Project 3**: Complete the naval AI trilogy

---


**🛡️ Vulnerability Agent** - Protecting naval vessels through intelligent electronic warfare response.

*Part of the Naval Agentic AI Research Series*